[{"content":"作者: Twac\n介绍 KVM(Kernel-based Virtual Machine)是一个开源的系统虚拟化模块，选择KVM的原因是因为自己的主力系统的Linux。但是出于不可抗力的原因（臭打游戏的）也不能完全脱离Windows，起初笔记本装了双系统，但是来回切换还是太麻烦了，虽然Linux有Wine、Proton等一些兼容层，但是效果还是不尽人意。\n于是就想在Linux上运行一台Windows虚拟机，但是KVM虚拟机配合QEMU的QXL图形渲染还是达不到（畅玩游戏）要求的。所以要利用KVM PCIe直通功能，让虚拟机独占高性能显卡，直接加载显卡对应的驱动，和显卡直接通信，给它加一双翅膀，拥有和物理机几乎同样的渲染性能。\n实验环境：\n虚拟机镜像：Windows 10 LTSC 2019 主机：神舟战神G7-CT7NK 套件：libvirt + qemu + virt-manager(GUI) 查看笔记本架构 目前主流的笔记本架构是MUXed和MUXLess。相比MUXLess来说，MUXed架构的笔记本更容易直通，因为它采用的是核显/独显切换工作方式。而MUXLess架构是核显输出，独显渲染。\n1 $ lspci | grep VGA #查看架构 如果独显以3D Controller开头，那么属于MUXLess；如果独显以VGA Controller开头，并且由于一个VGA核显输出(Intel/AMD)，那么属于MUXed。\n开启VT-d虚拟化以及IOMMU模块 BIOS开启VT-d，并在宿主机内核参数添加 iommu=on,iommu=pt ，其中 iommu=pt 为了防止不能直通的设备造成错误。\n1 $ dmesg | grep -e DMAR -e IOMMU #检查 dmesg 以确认 IOMMU 已经被正确启用 注意：\nIOMMU 是 Intel VT-d 和 AMD-Vi 的通用名称。 VT-d 指的是直接输入/输出虚拟化(Intel Virtualization Technology for Directed I/O)，不应与VT-x(x86平台下的Intel虚拟化技术，Intel Virtualization Technology)混淆。VT-x 可以让一个硬件平台作为多个“虚拟”平台，而 VT-d 提高了虚拟化的安全性、可靠性和 I/O 性能。 添加vfio模块屏蔽GPU 将vfio_pci vfio vfio_iommu_type1 vfio_virqfd添加到initramfs中，重新生成内核并重启。然后运行以下脚本，查看设备id.\n1 2 3 4 5 6 7 #!/bin/bash #查看是否生效 shopt -s nullglob for d in /sys/kernel/iommu_groups/*/devices/*; do n=${d#*/iommu_groups/*}; n=${n%%/*} printf \u0026#39;IOMMU Group %s \u0026#39; \u0026#34;$n\u0026#34; lspci -nns \u0026#34;${d##*/}\u0026#34; done; 可以看到group1对应的是本机独显设备 将以上设备id添加到/etc/modprobe.d/vfio.conf中启用vfio-pci驱动隔离GPU，编辑内容如下：\n1 2 3 /etc/modprobe.d/vfio.conf ---------------------------------------------------------------------- options vfio-pci ids=8086:1901,10de:2191,10de:1aeb,10de:1aec.10de:1aed 创建虚拟机 使用virt-manager(GUI)创建一台虚拟机：\n架构：Q35 固件：UEFI CPUs：host-passthrogh 内存：8192(8G) 启动盘\u0026amp;数据盘：驱动使用virtio 网络：NIC/NAT，驱动依然virtio 默认先用QEMU的QXL渲染，安装好virtio驱动\n显卡直通 先确定一下显卡 device-id 和 vendor-id 和 PCI 总线 ID 是否一致，如果不一致需要将 ID 修改为一致的，终端运行\n1 $ lspci -nnk | egrep -A3 \u0026#34;VGA|3D\u0026#34; #检查ID 如图我的独显的vendor-id是10de，device-id是2191;\nPCI系统总线的 vendor-id 是1558，device-id 是8550\n拿到ID后在virt-manager(GUI)直通独显设备，注意要将IOMMU组里的全部设备直通进去\n由于NVIDIA今年放开了虚拟化限制，提取显卡vbios是一个可选项，不需要绕过检测。\n此时如果开机，查看设备管理器会多出一个Microsoft基本显示适配器，说明已经识别到设备了，但是点开一看报了代码31，无法加载驱动。需要在虚拟机xml配置PCIe总线id。\n首先在xml配置的第一行\u0026lt;domain\u0026gt;标签配置qemu命名空间（详情看文末虚拟机xml配置）\u0026lt;domain xmlns:qemu=\u0026quot;http://libvirt.org/schemas/domain/qemu/1.0\u0026quot; type=\u0026quot;kvm\u0026quot;\u0026gt;\n然后在虚拟机xml配置尾部添加前面记录的PCIe总线id(注意进制转换)\n1 2 3 4 5 6 7 8 \u0026lt;qemu:override\u0026gt; \u0026lt;qemu:device alias=\u0026#34;hostdev0\u0026#34;\u0026gt; \u0026lt;qemu:frontend\u0026gt; \u0026lt;qemu:property name=\u0026#34;x-pci-sub-vendor-id\u0026#34; type=\u0026#34;unsigned\u0026#34; value=\u0026#34;5464\u0026#34;/\u0026gt; \u0026lt;qemu:property name=\u0026#34;x-pci-sub-device-id\u0026#34; type=\u0026#34;unsigned\u0026#34; value=\u0026#34;34128\u0026#34;/\u0026gt; \u0026lt;/qemu:frontend\u0026gt; \u0026lt;/qemu:device\u0026gt; \u0026lt;/qemu:override\u0026gt; 如果你的qemu版本低于7.0那么用如下配置即可\n1 2 3 4 5 6 \u0026lt;qemu:commandline\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-set\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;device.hostdev0.x-pci-sub-vendor-id=5464\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-set\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;device.hostdev0.x-pci-sub-device-id=34128\u0026#39;/\u0026gt; \u0026lt;/qemu:commandline\u0026gt; 做完这些重启虚拟机，驱动应该是正常运行，此时算是大功告成。直通显卡后，开启虚拟机后要切换独显输出，因为宿主机用的是核显，此时可以选择外接一个显示器（笔记本的HDMI/DP接口使用的是独显），或者利用libvirt hooks钩子函数让独显抢占当前笔记本显示器。\n至此显卡基本直通到此结束，还是趟了很多坑的。小小记录一下。 参考链接 ArchWiki - PCI passthrough via OVMF (简体中文) ArchWiki - Intel_GVT-g ArchWiki - Libvirt XML完整配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 \u0026lt;!-- 第一行`\u0026lt;domain\u0026gt;`标签配置qemu命名空间`\u0026lt;domain xmlns:qemu=\u0026#34;http://libvirt.org/schemas/domain/qemu/1.0\u0026#34; type=\u0026#34;kvm\u0026#34;\u0026gt;` --\u0026gt; \u0026lt;domain xmlns:qemu=\u0026#34;http://libvirt.org/schemas/domain/qemu/1.0\u0026#34; type=\u0026#34;kvm\u0026#34; \u0026lt;name\u0026gt;win10\u0026lt;/name\u0026gt; \u0026lt;uuid\u0026gt;7c121caf-30db-4a3a-82f6-d59ca87b802f\u0026lt;/uuid\u0026gt; \u0026lt;metadata\u0026gt; \u0026lt;libosinfo:libosinfo xmlns:libosinfo=\u0026#34;http://libosinfo.org/xmlns/libvirt/domain/1.0\u0026#34;\u0026gt; \u0026lt;libosinfo:os id=\u0026#34;http://microsoft.com/win/10\u0026#34;/\u0026gt; \u0026lt;/libosinfo:libosinfo\u0026gt; \u0026lt;/metadata\u0026gt; \u0026lt;memory unit=\u0026#34;KiB\u0026#34;\u0026gt;12582912\u0026lt;/memory\u0026gt; \u0026lt;currentMemory unit=\u0026#34;KiB\u0026#34;\u0026gt;12582912\u0026lt;/currentMemory\u0026gt; \u0026lt;vcpu placement=\u0026#34;static\u0026#34;\u0026gt;8\u0026lt;/vcpu\u0026gt; \u0026lt;os\u0026gt; \u0026lt;type arch=\u0026#34;x86_64\u0026#34; machine=\u0026#34;pc-q35-7.0\u0026#34;\u0026gt;hvm\u0026lt;/type\u0026gt; \u0026lt;loader readonly=\u0026#34;yes\u0026#34; type=\u0026#34;pflash\u0026#34;\u0026gt;/usr/share/edk2-ovmf/x64/OVMF_CODE.fd\u0026lt;/loader\u0026gt; \u0026lt;nvram\u0026gt;/var/lib/libvirt/qemu/nvram/win10_VARS.fd\u0026lt;/nvram\u0026gt; \u0026lt;/os\u0026gt; \u0026lt;features\u0026gt; \u0026lt;acpi/\u0026gt; \u0026lt;apic/\u0026gt; \u0026lt;hyperv mode=\u0026#34;custom\u0026#34;\u0026gt; \u0026lt;/hyperv\u0026gt; \u0026lt;vmport state=\u0026#34;off\u0026#34;/\u0026gt; \u0026lt;/features\u0026gt; \u0026lt;cpu mode=\u0026#34;host-passthrough\u0026#34; check=\u0026#34;none\u0026#34; migratable=\u0026#34;on\u0026#34;\u0026gt; \u0026lt;topology sockets=\u0026#34;1\u0026#34; dies=\u0026#34;1\u0026#34; cores=\u0026#34;4\u0026#34; threads=\u0026#34;2\u0026#34;/\u0026gt; \u0026lt;/cpu\u0026gt; \u0026lt;clock offset=\u0026#34;localtime\u0026#34;\u0026gt; \u0026lt;timer name=\u0026#34;rtc\u0026#34; tickpolicy=\u0026#34;catchup\u0026#34;/\u0026gt; \u0026lt;timer name=\u0026#34;pit\u0026#34; tickpolicy=\u0026#34;delay\u0026#34;/\u0026gt; \u0026lt;timer name=\u0026#34;hpet\u0026#34; present=\u0026#34;no\u0026#34;/\u0026gt; \u0026lt;timer name=\u0026#34;hypervclock\u0026#34; present=\u0026#34;yes\u0026#34;/\u0026gt; \u0026lt;/clock\u0026gt; \u0026lt;on_poweroff\u0026gt;destroy\u0026lt;/on_poweroff\u0026gt; \u0026lt;on_reboot\u0026gt;restart\u0026lt;/on_reboot\u0026gt; \u0026lt;on_crash\u0026gt;destroy\u0026lt;/on_crash\u0026gt; \u0026lt;pm\u0026gt; \u0026lt;suspend-to-mem enabled=\u0026#34;no\u0026#34;/\u0026gt; \u0026lt;suspend-to-disk enabled=\u0026#34;no\u0026#34;/\u0026gt; \u0026lt;/pm\u0026gt; \u0026lt;devices\u0026gt; \u0026lt;emulator\u0026gt;/usr/bin/qemu-system-x86_64\u0026lt;/emulator\u0026gt; \u0026lt;disk type=\u0026#34;file\u0026#34; device=\u0026#34;disk\u0026#34;\u0026gt; \u0026lt;driver name=\u0026#34;qemu\u0026#34; type=\u0026#34;qcow2\u0026#34; cache=\u0026#34;writeback\u0026#34; discard=\u0026#34;ignore\u0026#34;/\u0026gt; \u0026lt;source file=\u0026#34;/home/twac/VM/storage/win10.qcow2\u0026#34;/\u0026gt; \u0026lt;target dev=\u0026#34;vda\u0026#34; bus=\u0026#34;virtio\u0026#34;/\u0026gt; \u0026lt;boot order=\u0026#34;1\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x04\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;disk type=\u0026#34;file\u0026#34; device=\u0026#34;disk\u0026#34;\u0026gt; \u0026lt;driver name=\u0026#34;qemu\u0026#34; type=\u0026#34;qcow2\u0026#34; cache=\u0026#34;writeback\u0026#34; discard=\u0026#34;ignore\u0026#34;/\u0026gt; \u0026lt;source file=\u0026#34;/home/twac/VM/storage/DATA.qcow2\u0026#34;/\u0026gt; \u0026lt;target dev=\u0026#34;vdb\u0026#34; bus=\u0026#34;virtio\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x0a\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;disk type=\u0026#34;file\u0026#34; device=\u0026#34;cdrom\u0026#34;\u0026gt; \u0026lt;driver name=\u0026#34;qemu\u0026#34; type=\u0026#34;raw\u0026#34;/\u0026gt; \u0026lt;source file=\u0026#34;/home/twac/VM/ISO/Win10_21H2_Chinese(Simplified)_x64.iso\u0026#34;/\u0026gt; \u0026lt;target dev=\u0026#34;sdb\u0026#34; bus=\u0026#34;sata\u0026#34;/\u0026gt; \u0026lt;readonly/\u0026gt; \u0026lt;boot order=\u0026#34;2\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;drive\u0026#34; controller=\u0026#34;0\u0026#34; bus=\u0026#34;0\u0026#34; target=\u0026#34;0\u0026#34; unit=\u0026#34;1\u0026#34;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;disk type=\u0026#34;file\u0026#34; device=\u0026#34;cdrom\u0026#34;\u0026gt; \u0026lt;driver name=\u0026#34;qemu\u0026#34; type=\u0026#34;raw\u0026#34;/\u0026gt; \u0026lt;source file=\u0026#34;/home/twac/VM/ISO/virtio-win-0.1.208.iso\u0026#34;/\u0026gt; \u0026lt;target dev=\u0026#34;sdc\u0026#34; bus=\u0026#34;sata\u0026#34;/\u0026gt; \u0026lt;readonly/\u0026gt; \u0026lt;address type=\u0026#34;drive\u0026#34; controller=\u0026#34;0\u0026#34; bus=\u0026#34;0\u0026#34; target=\u0026#34;0\u0026#34; unit=\u0026#34;2\u0026#34;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;controller type=\u0026#34;usb\u0026#34; index=\u0026#34;0\u0026#34; model=\u0026#34;qemu-xhci\u0026#34; ports=\u0026#34;15\u0026#34;\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x02\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;0\u0026#34; model=\u0026#34;pcie-root\u0026#34;/\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;1\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;1\u0026#34; port=\u0026#34;0x10\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x0\u0026#34; multifunction=\u0026#34;on\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;2\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;2\u0026#34; port=\u0026#34;0x11\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x1\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;3\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;3\u0026#34; port=\u0026#34;0x12\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x2\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;4\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;4\u0026#34; port=\u0026#34;0x13\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x3\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;5\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;5\u0026#34; port=\u0026#34;0x14\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x4\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;6\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;6\u0026#34; port=\u0026#34;0x15\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x5\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;7\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;7\u0026#34; port=\u0026#34;0x16\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x6\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;8\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;8\u0026#34; port=\u0026#34;0x17\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x7\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;9\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;9\u0026#34; port=\u0026#34;0x18\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x03\u0026#34; function=\u0026#34;0x0\u0026#34; multifunction=\u0026#34;on\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;10\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;10\u0026#34; port=\u0026#34;0x19\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x03\u0026#34; function=\u0026#34;0x1\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;11\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;11\u0026#34; port=\u0026#34;0x1a\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x03\u0026#34; function=\u0026#34;0x2\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;12\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;12\u0026#34; port=\u0026#34;0x1b\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x03\u0026#34; function=\u0026#34;0x3\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;13\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;13\u0026#34; port=\u0026#34;0x1c\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x03\u0026#34; function=\u0026#34;0x4\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;14\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;14\u0026#34; port=\u0026#34;0x1d\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x03\u0026#34; function=\u0026#34;0x5\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;15\u0026#34; model=\u0026#34;pcie-root-port\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-root-port\u0026#34;/\u0026gt; \u0026lt;target chassis=\u0026#34;15\u0026#34; port=\u0026#34;0x8\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x01\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;pci\u0026#34; index=\u0026#34;16\u0026#34; model=\u0026#34;pcie-to-pci-bridge\u0026#34;\u0026gt; \u0026lt;model name=\u0026#34;pcie-pci-bridge\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x0b\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;sata\u0026#34; index=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x1f\u0026#34; function=\u0026#34;0x2\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#34;virtio-serial\u0026#34; index=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x03\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;interface type=\u0026#34;network\u0026#34;\u0026gt; \u0026lt;mac address=\u0026#34;52:54:00:98:77:e9\u0026#34;/\u0026gt; \u0026lt;source network=\u0026#34;default\u0026#34;/\u0026gt; \u0026lt;model type=\u0026#34;virtio\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x0c\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/interface\u0026gt; \u0026lt;input type=\u0026#34;mouse\u0026#34; bus=\u0026#34;ps2\u0026#34;/\u0026gt; \u0026lt;input type=\u0026#34;keyboard\u0026#34; bus=\u0026#34;ps2\u0026#34;/\u0026gt; \u0026lt;sound model=\u0026#34;ich6\u0026#34;\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x10\u0026#34; slot=\u0026#34;0x01\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/sound\u0026gt; \u0026lt;audio id=\u0026#34;1\u0026#34; type=\u0026#34;none\u0026#34;/\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;pci\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;driver name=\u0026#34;vfio\u0026#34;/\u0026gt; \u0026lt;source\u0026gt; \u0026lt;address domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x01\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;rom bar=\u0026#34;on\u0026#34; file=\u0026#34;/var/tmp/1660ti.rom\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x06\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;pci\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;address domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x01\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x1\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;rom bar=\u0026#34;on\u0026#34; file=\u0026#34;/var/tmp/1660ti.rom\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x07\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;pci\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;address domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x01\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x2\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;rom bar=\u0026#34;on\u0026#34; file=\u0026#34;/var/tmp/1660ti.rom\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x08\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;pci\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;address domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x01\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x3\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;rom bar=\u0026#34;on\u0026#34; file=\u0026#34;/var/tmp/1660ti.rom\u0026#34;/\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x09\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;usb\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;vendor id=\u0026#34;0x046d\u0026#34;/\u0026gt; \u0026lt;product id=\u0026#34;0xc332\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;address type=\u0026#34;usb\u0026#34; bus=\u0026#34;0\u0026#34; port=\u0026#34;1\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;usb\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;vendor id=\u0026#34;0x05ac\u0026#34;/\u0026gt; \u0026lt;product id=\u0026#34;0x024f\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;address type=\u0026#34;usb\u0026#34; bus=\u0026#34;0\u0026#34; port=\u0026#34;2\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;pci\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;address domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x1f\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x10\u0026#34; slot=\u0026#34;0x02\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;pci\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;address domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x1f\u0026#34; function=\u0026#34;0x3\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x10\u0026#34; slot=\u0026#34;0x03\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;pci\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;address domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x1f\u0026#34; function=\u0026#34;0x4\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x10\u0026#34; slot=\u0026#34;0x04\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;hostdev mode=\u0026#34;subsystem\u0026#34; type=\u0026#34;pci\u0026#34; managed=\u0026#34;yes\u0026#34;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;address domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x00\u0026#34; slot=\u0026#34;0x1f\u0026#34; function=\u0026#34;0x5\u0026#34;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x10\u0026#34; slot=\u0026#34;0x05\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/hostdev\u0026gt; \u0026lt;memballoon model=\u0026#34;virtio\u0026#34;\u0026gt; \u0026lt;address type=\u0026#34;pci\u0026#34; domain=\u0026#34;0x0000\u0026#34; bus=\u0026#34;0x05\u0026#34; slot=\u0026#34;0x00\u0026#34; function=\u0026#34;0x0\u0026#34;/\u0026gt; \u0026lt;/memballoon\u0026gt; \u0026lt;/devices\u0026gt; \u0026lt;qemu:override\u0026gt; \u0026lt;qemu:device alias=\u0026#34;hostdev0\u0026#34;\u0026gt; \u0026lt;qemu:frontend\u0026gt; \u0026lt;qemu:property name=\u0026#34;x-pci-sub-vendor-id\u0026#34; type=\u0026#34;unsigned\u0026#34; value=\u0026#34;5464\u0026#34;/\u0026gt; \u0026lt;qemu:property name=\u0026#34;x-pci-sub-device-id\u0026#34; type=\u0026#34;unsigned\u0026#34; value=\u0026#34;34128\u0026#34;/\u0026gt; \u0026lt;/qemu:frontend\u0026gt; \u0026lt;/qemu:device\u0026gt; \u0026lt;/qemu:override\u0026gt; \u0026lt;/domain\u0026gt; ","date":"2022-11-29T02:45:32+08:00","image":"https://linux.feldan.top/p/kvm%E8%99%9A%E6%8B%9F%E6%9C%BAgpu%E7%9B%B4%E9%80%9A%E5%AE%9E%E9%AA%8C%E4%B8%BA%E6%B8%B8%E6%88%8F%E5%8A%A9%E5%8A%9B/neofetch_hu00cf82c41589ac4736027c4c3c067eb0_263062_120x120_fill_box_smart1_3.png","permalink":"https://linux.feldan.top/p/kvm%E8%99%9A%E6%8B%9F%E6%9C%BAgpu%E7%9B%B4%E9%80%9A%E5%AE%9E%E9%AA%8C%E4%B8%BA%E6%B8%B8%E6%88%8F%E5%8A%A9%E5%8A%9B/","title":"KVM虚拟机GPU直通实验，为游戏助力"},{"content":"关机/重启/注销 常用命令 作用 shutdown -h now 即刻关机 shutdown -h 10 10分钟后关机 shutdown -h 11:00 11：00关机 shutdown -h +10 预定时间关机（10分钟后） shutdown -c 取消指定时间关机 shutdown -r now 重启 shutdown -r 10 10分钟之后重启 shutdown -r 11:00 定时重启 reboot 重启 init 6 重启 init 0 ⽴刻关机 telinit 0 关机 poweroff ⽴刻关机 halt 关机 sync buff数据同步到磁盘 logout 退出登录Shell 系统信息和性能查看 常用命令 作用 uname -a 查看内核/OS/CPU信息 uname -r 查看内核版本 uname -m 查看处理器架构 arch 查看处理器架构 hostname 查看计算机名 who 显示当前登录系统的⽤户 who am i 显示登录时的⽤户名 whoami 显示当前⽤户名 cat /proc/version 查看linux版本信息 cat /proc/cpuinfo 查看CPU信息 cat /proc/interrupts 查看中断 cat /proc/loadavg 查看系统负载 uptime 查看系统运⾏时间、⽤户数、负载 env 查看系统的环境变量 lsusb -tv 查看系统USB设备信息 lspci -tv 查看系统PCI设备信息 lsmod 查看已加载的系统模块 grep MemTotal /proc/meminfo 查看内存总量 grep MemFree /proc/meminfo 查看空闲内存量 free -m 查看内存⽤量和交换区⽤量 date 显示系统⽇期时间 cal 2021 显示2021⽇历表 top 动态显示cpu/内存/进程等情况 vmstat 1 20 每1秒采⼀次系统状态，采20次 iostat 查看io读写/cpu使⽤情况 查看io读写/cpu使⽤情况 查询cpu使⽤情况（1秒⼀次，共10次） sar -d 1 10 查询磁盘性能 磁盘和分区 常用命令 作用 fdisk -l 查看所有磁盘分区 swapon -s 查看所有交换分区 df -h 查看磁盘使⽤情况及挂载点 df -hl 同上 du -sh /dir 查看指定某个⽬录的⼤⼩ du -sk * | sort -rn 从⾼到低依次显示⽂件和⽬录⼤⼩ mount /dev/hda2 /mnt/hda2 挂载hda2盘 mount -t ntfs /dev/sdc1 /mnt/usbhd1 指定⽂件系统类型挂载（如ntfs） mount -o loop xxx.iso /mnt/cdrom 挂 载 iso ⽂ 件 umount -v /dev/sda1 通过设备名卸载 umount -v /mnt/mymnt 通过挂载点卸载 fuser -km /mnt/hda1 强制卸载(慎⽤) 用户和用户组 常用命令 作用 useradd twac 创建⽤户 userdel -r twac 删除⽤户 usermod -g group_name user_name 修改⽤户的组 usermod -aG group_name user_name 将⽤户添加到组 usermod -s /bin/ksh -d /home/codepig –g dev twac 修改⽤户twac的登录Shell、主⽬录以及⽤户组 groups test 查看test⽤户所在的组 groupadd group_name 创建⽤户组 groupdel group_name 删除⽤户组 groupmod -n new_name old_name 重命名⽤户组 su - user_name su - user_name passwd 修改⼝令 passwd twac 修改某⽤户的⼝令 w 查看活动⽤户 id twac 查看指定⽤户twac信息 last 查看⽤户登录⽇志 crontab -l 查看当前⽤户的计划任务 cut -d: -f1 /etc/passwd 查看系统所有⽤户 cut -d: -f1 /etc/group 查看系统所有组 网络和进程管理 常用命令 作用 ifconfig 查看⽹络接⼝属性 ifconfig eth0 查看某⽹卡的配置 route -n 查看路由表 netstat -lntp 查看所有监听端⼝ netstat -antp 查看已经建⽴的TCP连接 netstat -lutp 查看TCP/UDP的状态信息 ifup eth0 启⽤eth0⽹络设备 ifdown eth0 禁⽤eth0⽹络设备 iptables -L 查看iptables规则 ifconfig eth0 192.168.1.1 netmask 255.255.255.0 配置ip地址 dhclient eth0 以dhcp模式启⽤eth0 route add -net 0/0 gw Gateway_IP 配置默认⽹关 route add -net 192.168.0.0 netmask 255.255.0.0 gw 192.168.1.1 配置静态路由到达⽹络'192.168.0.0/16' route del 0/0 gw Gateway_IP 删除静态路由 hostname 查看主机名 host www.baidu.com 解析主机名 nslookup www.baidu.com 查询DNS记录，查看域名解析是否正常 ps -ef 查看所有进程 ps -ef | grep twac 过滤出你需要的进程 kill -s name kill指定名称的进程 kill -s pid kill指定pid的进程 top 实时显示进程状态 vmstat 1 20 每1秒采⼀次系统状态，采20次 iostat iostat sar -u 1 10 查询cpu使⽤情况（1秒⼀次，共10次） sar -d 1 10 查询磁盘性能 常见系统服务命令 常用命令 作用 chkconfig \u0026ndash;list 列出系统服务 service \u0026lt;服务名\u0026gt; status 查看某个服务 service \u0026lt;服务名\u0026gt; start 启动某个服务 service \u0026lt;服务名\u0026gt; stop 终⽌某个服务 service \u0026lt;服务名\u0026gt; restart 重启某个服务 systemctl status \u0026lt;服务名\u0026gt; 查看某个服务 systemctl start \u0026lt;服务名\u0026gt; 启动某个服务 systemctl stop \u0026lt;服务名\u0026gt; 终⽌某个服务 systemctl restart \u0026lt;服务名\u0026gt; 重启某个服务 systemctl enable \u0026lt;服务名\u0026gt; 关闭⾃启动 systemctl disable \u0026lt;服务名\u0026gt; 关闭⾃启动 文件和目录操作 常用命令 作用 cd \u0026lt;⽬录名\u0026gt; 进⼊某个⽬录 cd .. 回上级⽬录 cd ../.. 回上两级⽬录 cd 进个⼈主⽬录 cd - 回上⼀步所在⽬录 pwd 显示当前路径 ls 查看⽂件⽬录列表 ls -F 查看⽬录中内容（显示是⽂件还是⽬录） ls -l 查看⽂件和⽬录的详情列表 ls -a 查看隐藏⽂件 ls -lh 查看⽂件和⽬录的详情列表（增强⽂件⼤⼩易读性） ls -lSr 查看⽂件和⽬录列表（以⽂件⼤⼩升序查看） tree 查看⽂件和⽬录的树形结构 mkdir \u0026lt;⽬录名\u0026gt; 创建⽬录 mkdir dir1 dir2 同时创建两个⽬录 mkdir -p /tmp/dir1/dir2 创建⽬录树 rm -f file1 删除\u0026rsquo;file1\u0026rsquo;⽂件 rmdir dir1 删除\u0026rsquo;dir1\u0026rsquo;⽬录 rm -rf dir1 删除\u0026rsquo;dir1\u0026rsquo;⽬录和其内容 rm -rf dir1 dir2 同时删除两个⽬录及其内容 mv old_dir new_dir 重命名/移动⽬录 cp file1 file2 复制⽂件 cp dir/* . 复制某⽬录下的所有⽂件⾄当前⽬录 cp -a dir1 dir2 复制⽬录 cp -a /tmp/dir1 . 复制⼀个⽬录⾄当前⽬录 ln -s file1 link1 创建指向⽂件/⽬录的软链接 ln file1 lnk1 创建指向⽂件/⽬录的物理链接 find / -name file1 从跟⽬录开始搜索⽂件/⽬录 find / -user user1 搜索⽤户user1的⽂件/⽬录 find /dir -name *.bin 在⽬录/dir中搜带有.bin后缀的⽂件 locate \u0026lt;关键词\u0026gt; 快速定位⽂件 locate *.mp4 寻找.mp4结尾的⽂件 whereis \u0026lt;关键词\u0026gt; 显示某⼆进制⽂件/可执⾏⽂件的路径 which \u0026lt;关键词\u0026gt; 查找系统⽬录下某的⼆进制⽂件 chmod ugo+rwx dir1 设置⽬录所有者(u)、群组(g)及其他⼈(o)的读（r）写(w)执⾏(x)权限 chmod go-rwx dir1 移除群组(g)与其他⼈(o)对⽬录的读写执⾏权限 chown user1 file1 改变⽂件的所有者属性 chown -R user1 dir1 改变⽬录的所有者属性 chgrp group1 file1 改变⽂件群组 chown user1:group1 file1 改变⽂件的所有⼈和群组 文件查看和处理 常用命令 作用 cat file1 查看⽂件内容 cat -n file1 查看内容并标示⾏数 tac file1 从最后⼀⾏开始反看⽂件内容 more file1 more file1 less file1 类似more命令，但允许反向操作 head -2 file1 查看⽂件前两⾏ tail -2 file1 查看⽂件后两⾏ tail -f /log/msg 实时查看添加到⽂件中的内容 grep twac hello.txt 在⽂件hello.txt中查找关键词twac grep ^sheep hello.txt 在⽂件hello.txt中查找以sheep开头的内容 grep [0-9] hello.txt 选择hello.txt⽂件中所有包含数字的⾏ sed \u0026rsquo;s/s1/s2/g\u0026rsquo; hello.txt 将hello.txt⽂件中的s1替换成s2 sed \u0026lsquo;/^$/d\u0026rsquo; hello.txt 从hello.txt⽂件中删除所有空⽩⾏ sed \u0026lsquo;/ *#/d; /^$/d\u0026rsquo; hello.txt 从hello.txt⽂件中删除所有注释和空⽩⾏ sed -e \u0026lsquo;1d\u0026rsquo; hello.txt 从⽂件hello.txt 中排除第⼀⾏ sed -n \u0026lsquo;/s1/p\u0026rsquo; hello.txt 查看只包含关键词\u0026quot;s1\u0026quot;的⾏ sed -e \u0026rsquo;s/ *$//\u0026rsquo; hello.txt 删除每⼀⾏最后的空⽩字符 sed -e \u0026rsquo;s/s1//g\u0026rsquo; hello.txt 从⽂档中只删除词汇s1并保留剩余全部 sed -n \u0026lsquo;1,5p;5q\u0026rsquo; hello.txt 查看从第⼀⾏到第5⾏内容 sed -n \u0026lsquo;5p;5q\u0026rsquo; hello.txt 查看第5⾏ paste file1 file2 合并两个⽂件或两栏的内容 paste -d \u0026lsquo;+\u0026rsquo; file1 file2 合并两个⽂件或两栏的内容，中间⽤\u0026quot;+\u0026ldquo;区分 sort file1 file2 排序两个⽂件的内容 comm -1 file1 file2 ⽐较两个⽂件的内容(去除\u0026rsquo;file1\u0026rsquo;所含内容) comm -2 file1 file2 ⽐较两个⽂件的内容(去除\u0026rsquo;file2\u0026rsquo;所含内容 comm -3 file1 file2 ⽐较两个⽂件的内容(去除两⽂件共有部分) 打包和解压 常用命令 作用 zip xxx.zip file 压缩⾄zip包 zip -r xxx.zip file1 file2 dir1 将多个⽂件+⽬录压成zip包 unzip xxx.zip 解压zip包 tar -cvf xxx.tar file 创建⾮压缩tar包 tar -cvf xxx.tar file1 file2 dir1 将多个⽂件+⽬录打tar包 tar -tf xxx.tar 查看tar包的内容 tar -xvf xxx.tar 解压tar包 tar -xvf xxx.tar -C /dir 将tar包解压⾄指定⽬录 tar -cvfj xxx.tar.bz2 dir 创建bz2压缩包 tar -jxvf xxx.tar.bz2 解压bz2压缩包 tar -cvfz xxx.tar.gz dir 创建gzip压缩包 tar -zxvf xxx.tar.gz 解压gzip压缩包 bunzip2 xxx.bz2 解压bz2压缩包 bzip2 filename 压缩⽂件 gunzip xxx.gz 解压gzip压缩包 gzip filename 压缩⽂件 gzip -9 filename 最⼤程度压缩 RPM包管理命令 常用命令 作用 rpm -qa 查看已安装的rpm包 rpm -q pkg_name 查询某个rpm包 rpm -q \u0026ndash;whatprovides xxx 显示xxx功能是由哪个包提供的 rpm -q \u0026ndash;whatrequires xxx 显示xxx功能被哪个程序包依赖的 rpm -q \u0026ndash;changelog xxx 显示xxx包的更改记录 rpm -qi pkg_name 查看⼀个包的详细信息 rpm -qd pkg_name 查询⼀个包所提供的⽂档 rpm -qc pkg_name 查看已安装rpm包提供的配置⽂件 rpm -ql pkg_name 查看⼀个包安装了哪些⽂件 rpm -qf filename 查看某个⽂件属于哪个包 rpm -qR pkg_name 查询包的依赖关系 rpm -ivh xxx.rpm 安装rpm包 rpm -ivh \u0026ndash;test xxx.rpm 测试安装rpm包 rpm -ivh \u0026ndash;nodeps xxx.rpm 安装rpm包时忽略依赖关系 rpm -e xxx 卸载程序包 rpm -Fvh pkg_name 升级确定已安装的rpm包 rpm -Uvh pkg_name 升级rpm包(若未安装则会安装) rpm -V pkg_name RPM包详细信息校验 YUM包管理命令 常用命令 作用 yum repolist enabled 显示可⽤的源仓库 yum search pkg_name 搜索软件包 yum install pkg_name 下载并安装软件包 yum install \u0026ndash;downloadonly pkg_name 只 下 载 不 安 装 yum list 显示所有程序包 yum list installed 查看当前系统已安装包 yum list updates 查看可以更新的包列表 yum check-update 查看可升级的软件包 yum update 更新所有软件包 yum update pkg_name 升级指定软件包 yum deplist pkg_name 列出软件包依赖关系 yum remove pkg_name 删除软件包 yum clean all 清除缓存 yum clean packages 清除缓存的软件包 yum clean headers 清除缓存的header DPKG包管理命令 常用命令 作用 dpkg -c xxx.deb 列出deb包的内容 dpkg -i xxx.deb 安装/更新deb包 dpkg -r pkg_name 移除deb包 dpkg -P pkg_name 移除deb包(不保留配置) dpkg -l 查看系统中已安装deb包 dpkg -l pkg_name 显示包的⼤致信息 dpkg -L pkg_name 查看deb包安装的⽂件 dpkg -s pkg_name 查看包的详细信息 dpkg –unpack xxx.deb 解开deb包的内容 APT软件⼯具 常用命令 作用 apt-cache search pkg_name 搜索程序包 apt-cache show pkg_name 获取包的概览信息 apt-get install pkg_name 安装/升级软件包 apt-get purge pkg_name 卸载软件（包括配置） apt-get remove pkg_name 卸载软件（不包括配置） apt-get update 更新包索引信息 apt-get upgrade 更新已安装软件包 apt-get clean 清理缓存 ","date":"2021-12-20T03:06:49+08:00","image":"https://linux.feldan.top/p/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/Windows_hu2a02223aad1b5ce0d2b9e4f82a2d43eb_75813_120x120_fill_box_smart1_3.png","permalink":"https://linux.feldan.top/p/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","title":"Linux常用命令"},{"content":"课表 (.ics) 生成 如果你是广东科技学院学生，请访问 ZFClassTable2ICS ，可自动生成学生课表。 简介 iCalendar 是广泛使用的日历数据交换标准，在诸如 Apple 日历、Google Calendar 的日历 app 中创建日历项，不仅可清晰的了解日程安排，更可体验 iOS、Android 系统为日历提供的各种功能：计划出行时间、日程提醒、如 Siri 与 Google Assistant 等智能语音助理自动化服务等。\n不过，并非所有学校都为学生提供 ics 日历，因此本代码旨在用 Python 3 协助你创建一个自己的 ics 日历课表。\n功能 经测试，兼容 Apple 日历、Google CalendarOutlook Calendar、MIUI Calendar、Boomsung Calendar 等日历应用，支持上述应用的日历订阅(特别提醒部分一加手机日历不支持导入ics文件至日历,需要自行下载完整版的日历app)（如果以本代码生成的文件创建日历订阅） 支持录入各种信息，示例代码中包含：教室、课程名称、教师、必修/选修状态等 支持多种课程时间安排：单独的周数，范围的周数，奇偶周数，如 \u0026ldquo;第2周，5 至 11 周中的单数周，13 至 17 周\u0026rdquo; 支持添加教学楼信息，其中 Apple 日历还支持教学楼 GPS 定位 ，在日历项中添加教学楼，就可利用 iOS 的 Siri 分析功能在多个 app 中获得附加功能 导入到系统日历后，支持诸多由操作系统提供的日历功能：例如，在 iOS 设备中添加日历项后，你可以直接向 Siri 询问：「我下周五有什么日程？」获得下周五的课表；或是在 Apple Watch 表盘上显示下一个课程的时间；或是使用 Shortcut 捷径进行更多操作。 使用 生成后使用 关于导入日历和订阅日历 名词释义 导入日历\n导入日历是一次性行为，生成 ics 并导入日历后，日历 app 将仅保留 ics 文件中的日历项。在需要变更日历时，可能需要先移除已有的日历项，再重新导入新的日历。\n其特点是数据一经导入后便进行存档，并且，你可以随时在日历 app 中修改日历项的内容，例如调整日历项的时间、地点、标题、内容等等。\n导入日历相当于是复制了 ics 中的日历项并创建到你的日历当中。\n订阅日历\n订阅日历是一个只读行为，你需要向日历 app 提供日历（ics 文件）的地址，日历 app 将自动定时请求这一地址，以检查日历有无发生变更，并在变更时自动将更新的日历同步到你的日历 app 中。\n其特点是数据随远程 ics 文件的变化而变化，并且，日历项完全由 ics 文件决定，你不能修改日历项的任何内容。\n订阅日历的好处是，只要服务端的日历变更，日历 app 中的数据便会获得同步变更。\niOS、iPadOS 用户 导入日历 要导入日历，你需要在 iOS、iPadOS 上设法打开 ics 文件，较为简单的方法是：（iOS 与 iPadOS 相同）\n如果你有 Mac 等其他 Apple 设备并支持 AirDrop，将 ics 文件 AirDrop 到需要导入日历的 iOS 设备即可； 如果你使用 iOS 自带的邮件 app，将 ics 作为附件发送邮件给设备，并点击附件中的 ics 文件； 如果你有网络服务器，或有办法将 ics 上传到一个网站上，使用 Safari 浏览器打开链接到 ics 文件的地址； 导入的界面类似下图\n点击「添加全部」按钮，将会导入所有日历项到你的日历当中。\n注意！若你只有一个日历（日历是容纳日历项的地方，iOS 支持创建多个日历），点击「添加全部」将直接添加到你的唯一日历中，此日历可能包含了你的其他日历项，直接添加到默认日历可能造成后续删除课表极为不便（难以进行批量删除）。\n强烈建议首先创建一个空白日历，此后点击「添加全部」，iOS 会提示你选择导入的日历，选择空白日历有利于后续进行批量管理。\n订阅日历 要订阅日历，你必须将 ics 放在一个固定可访问的 URL 地址，这可能要求你有可控制的 Web 服务器。\nAndroid 用户 导入日历 要导入日历，通iOS 设备一样,你需要在Android 上设法打开 ics 文件，较为简单的方法是：\n浏览器下载ics文件,使用日历打开. 如果你使用邮件 app，将 ics 作为附件发送邮件给设备，并点击附件中的 ics 文件； 如果你有网络服务器，或有办法将 ics 上传到一个网站上，使用 Safari 浏览器打开链接到 ics 文件的地址； 导入的界面类似下图\n点击「添加全部」按钮，将会导入所有日历项到你的日历当中。\n注意！若你只有一个日历（日历是容纳日历项的地方，Android 同样支持创建多个日历），点击「添加全部」将直接添加到你的唯一日历中，此日历可能包含了你的其他日历项，直接添加到默认日历可能造成后续删除课表极为不便（难以进行批量删除）。\n强烈建议首先创建一个空白日历，此后点击「添加全部」，Android 会提示你选择导入的日历，选择空白日历有利于后续进行批量管理。\n订阅日历 要订阅日历，你必须将 ics 放在一个固定可访问的 URL 地址，这可能要求你有可控制的 Web 服务器。\n为什么使用 iCal 在诸如 Apple 日历、Google Calendar 的日历 app 中创建日历项，不仅可清晰的了解日程安排，更可体验 iOS、Android 系统为日历提供的各种功能：计划出行时间、日程提醒、如 Siri 与 Google Assistant 等智能语音助理自动化服务等 例如，在设备中添加日历项后，你可以直接向语音助手询问「明天有什么日程」 ","date":"2021-11-20T03:06:49+08:00","permalink":"https://linux.feldan.top/p/%E5%85%B3%E4%BA%8E%E8%AF%BE%E7%A8%8B%E8%A1%A8%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/","title":"关于课程表使用心得"},{"content":"🖥服务与技巧 SID (Student ID) 相关 🆔学号 学号的含义 💳校园卡\u0026amp;学生证 校园卡 信息服务 🌐校园网络 校园网络介绍与连接指南 （包括无线网络，有线网络） 🐧Linux用户协会（LUG）服务建设中 💿GDUST开源软件镜像站：包含常用镜像与软件源 （未开放公网访问） 。 教学相关 👩‍🏫广东科技学院教学综合信息服务平台 查询成绩/课表/选课\n教务系统 - 内网 教务系统 - 外网 五育综合数据平台 - 内网 📅课表 (.ics) 生成 ClassTable2ICS食用教程 🏫教务处通知 第一时间获知考试/选课/活动信息\n教务处通知公告 通讯相关 📧电子邮件服务(教育邮箱) 电子邮件服务 💬企业微信 企业微信 软件授权 图书馆服务 关注公众号（广东科技学院图书馆）\n电子数据库 CNKI中国知网数据库（校内免费下载） CNKI中国知网数据库（校外访问入口） 广东科技学院 | 网络教学平台 广东科技学院图书馆馆藏数字资源服务平台（内网） 🕹️电子设备 路由器 ","date":"2021-09-11T02:17:56+08:00","image":"https://linux.feldan.top/p/%E5%B9%BF%E7%A7%91%E6%89%8B%E5%86%8C/Snipaste_2021-09-11_02-25-32_hua4b486f06df2df859768642016deb09b_179351_120x120_fill_q75_box_smart1.jpg","permalink":"https://linux.feldan.top/p/%E5%B9%BF%E7%A7%91%E6%89%8B%E5%86%8C/","title":"广科手册"}]